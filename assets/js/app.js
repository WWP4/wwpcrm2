(function(){const LS_KEY='wwcrm_bootstrap_starter_v1';let state=JSON.parse(localStorage.getItem(LS_KEY)||'{}');if(!state.projects){state={projects:[{name:'Lincoln Elementary',status:'In Progress',progress:67,budget:120000},{name:'Oak Grove Church',status:'Planning',progress:14,budget:48000},{name:'Maple Ridge City Park',status:'Completed',progress:100,budget:210000},{name:'Riverbend Montessori',status:'Needs Review',progress:32,budget:73000}],files:[{name:'Site Plan.pdf',type:'pdf',project:'Lincoln Elementary'},{name:'Budget.xlsx',type:'xlsx',project:'Oak Grove Church'},{name:'Inspection.jpg',type:'jpg',project:'Maple Ridge City Park'}],grants:[{name:'Community Parks Fund',project:'Lincoln Elementary',status:'Submitted',deadline:plusDays(14)},{name:'Healthy Kids Playground Grant',project:'Oak Grove Church',status:'Draft',deadline:plusDays(28)}],team:[{name:'Melissa',role:'Director',email:'melissa@example.com'},{name:'James',role:'Project Manager',email:'james@example.com'},{name:'Ashley',role:'Grants Lead',email:'ashley@example.com'},{name:'Diego',role:'Installer Coordinator',email:'diego@example.com'}]};save();}function save(){localStorage.setItem(LS_KEY,JSON.stringify(state));}function plusDays(n){const d=new Date();d.setDate(d.getDate()+n);return d.toISOString().slice(0,10);}window.initDashboardCharts=function(){if(!window.ApexCharts)return;const el=document.querySelector('#chart-progress');if(el){const completed=state.projects.filter(p=>p.progress===100).length;const inprog=state.projects.filter(p=>p.progress>0&&p.progress<100).length;const planning=state.projects.filter(p=>p.progress===0||p.status==='Planning').length;new ApexCharts(el,{chart:{type:'donut',height:260,background:'transparent'},labels:['Completed','In Progress','Planning'],series:[completed,inprog,planning],theme:{mode:'dark'},colors:['#20c997','#f0ad4e','#72d1ff'],legend:{labels:{colors:'#e8eefc'}}}).render();}const el2=document.querySelector('#chart-budget');if(el2){const cats=state.projects.map(p=>p.name);const data=state.projects.map(p=>p.budget);new ApexCharts(el2,{chart:{type:'bar',height:260,background:'transparent'},series:[{name:'Budget ($)',data:data}],xaxis:{categories:cats,labels:{style:{colors:'#9cb1d6'}}},yaxis:{labels:{style:{colors:'#9cb1d6'}}},theme:{mode:'dark'},colors:['#72d1ff']}).render();}};window.initProjectTable=function(){if(!window.DataTable)return;const table=document.querySelector('#projectsTable');if(!table)return;const tbody=table.querySelector('tbody');tbody.innerHTML=state.projects.map(p=>(`<tr><td>${p.name}</td><td><span class="badge bg-info-subtle text-light">${p.status}</span></td><td><div class="progress bg-transparent border border-ww rounded-3" style="height:10px"><div class="progress-bar bg-info" style="width:${p.progress}%"></div></div></td><td>$${p.budget.toLocaleString()}</td></tr>`)).join('');new DataTable(table,{responsive:true,pageLength:5});};window.handleCreateProject=function(e){e.preventDefault();const name=document.querySelector('#projName').value.trim()||'Untitled Project';const status=document.querySelector('#projStatus').value;const progress=parseInt(document.querySelector('#projProgress').value||'0',10);const budget=parseInt(document.querySelector('#projBudget').value||'0',10);state.projects.unshift({name,status,progress,budget});save();alert('Project created (demo). Reload Projects page to see it in the table.');e.target.reset();};window.initDropzone=function(){if(!window.Dropzone)return;Dropzone.autoDiscover=false;const dzEl=document.querySelector('#wwDropzone');if(!dzEl)return;new Dropzone(dzEl,{url:'/demo-upload',autoProcessQueue:false,addRemoveLinks:true});};})();